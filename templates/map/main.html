{% extends "base.html" %}
{% block content %}
    <div class="container-fluid">
        <div id="map" style="width:100%;height:90%;margin:5px;"></div>
    </div>

    <script>
        var map = new naver.maps.Map('map', {
            center: new naver.maps.LatLng(37.5617306, 126.94367550000001),
            zoom: 15
        });
        var markers = [], infoWindows = [];

        {% for i in data %}
            var position = new naver.maps.LatLng({{i.11}}, {{ i.12 }});

            var marker = new naver.maps.Marker({
                map: map,
                position: position
            });

            var infoWindow = new naver.maps.InfoWindow({
                content:
                    '<a href="{% url "map:cctv" %}" target="_blank" style="width:auto;text-align:center;padding:10px;"><b>"{{ i.2 }}"</b></a>'
            });
            markers.push(marker);
            infoWindows.push(infoWindow);
        {% endfor %}

        naver.maps.Event.addListener(map, 'idle', function () {
            updateMarkers(map, markers);
        });

        function updateMarkers(map, markers) {
            var mapBounds = map.getBounds();
            var marker, position;

            for (var i = 0; i < markers.length; i++) {

                marker = markers[i];
                position = marker.getPosition();

                if (mapBounds.hasLatLng(position)) {
                    showMarker(map, marker);
                } else {
                    hideMarker(map, marker);
                }
            }
        }

        function showMarker(map, marker) {

            if (marker.setMap(null)) return;
            marker.setMap(map);
        }

        function hideMarker(map, marker) {

            if (!marker.setMap(map)) return;
            marker.setMap(null);
        }

        function getClickHandler(seq) {
            return function (e) {
                var marker = markers[seq],
                    infoWindow = infoWindows[seq];

                if (infoWindow.getMap()) {
                    infoWindow.close();
                } else {
                    infoWindow.open(map, marker);
                }
            }
        }

        for (var i = 0, ii = markers.length; i < ii; i++) {
            naver.maps.Event.addListener(markers[i], 'click', getClickHandler(i));
        }


    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"
            integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
{% endblock %}


